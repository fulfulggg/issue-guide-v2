# Production Foundation — Design

## 前提

- requirements.md は承認済み
- Workspace の永続化は未確定であり、Production Foundation では単一インスタンス稼働中の揮発データとして扱うことを許容する（再起動/複数インスタンスで 404 になりうる）。
- Workspace は in-memory で保持され、サーバ側で数の上限（例: 1000件）を設ける場合、上限到達後は作成が失敗（例: 503）しうる。

## 1) 何を変えるか

- 本番環境でアプリケーションが「閲覧可能」な状態で動作するための前提条件を定義する。
- 本番環境で将来の機能（生成・編集・デプロイ）を載せるために必要な「土台」の範囲を定義する。
- Workspace（下書き/ドラフト）という概念を導入し、本番で参照可能にするための要件を定義する。

## 2) なぜ安全か

- 本PRは設計の意図（要求の整理）に加えて、API疎通およびWorkspace概念に関する最小限の実装を含む。
- 変更範囲を「土台（閲覧・API疎通・Workspace概念）」に限定し、生成・編集・デプロイ等の高リスク領域は別PRに分離する。
- テスト観点を明示することで、後続の実装で満たすべき条件が固定され、回帰検知が容易になる。

## 3) 責務が残る場所

- 生成（画像/プロンプト→初案生成）: 本ドキュメントでは扱わず、次のPR以降で要件化・設計する。
- 編集（見ながら柔軟に変更）: 本ドキュメントでは扱わず、次のPR以降で要件化・設計する。
- デプロイ（Vercel等へそのままデプロイ）: 本ドキュメントでは扱わず、次のPR以降で要件化・設計する。
- 保存先の具体的技術選定（DB/KV/Blob等）: 本ドキュメントでは確定しない。
- 認証・認可の最終形: 本ドキュメントでは確定しない。

## 4) テスト観点

- 本番環境でアプリケーションがURL経由で表示できること（最低限トップが表示できる）。

- 本番環境でAPIが配置され、疎通できること（例: 200が返る）。

- Workspace概念について、以下の観点を満たすこと：

  - 作成できる
  - 識別子で参照できる
  - 不正入力/不正参照に対して適切なエラーを返す（少なくとも4xx/5xxの区別）

- 機密情報（APIキー等）をリポジトリに含めない運用であること（設定方法が明確であること）。

- Backout（撤回）が可能であること（このPRで追加した要素を取り除いても閲覧が成立する）。
